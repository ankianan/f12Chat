!function(){"use strict";function a(a){return"/notFound"==a.route&&"/"==a.route,h.setItem("appState",a)}function b(){h.config(e.storage);var a=void 0;return a=new f(function(a,b){h.getItem("version").then(function(b){!b||b<e.storage.version?(h.removeItem("appState").then(function(){h.setItem("version",e.storage.version)}),a(null)):h.getItem("appState").then(function(b){a(b)})})})}var c="//"+document.location.host,d={name:"naukriDB",version:6,storeName:"naukriStore",description:"Naukri jobseeker SPA"},e={base:c,storage:d},f="undefined"==typeof Promise?require("es6-promise").Promise:Promise,g=window.interfaces,h=g.localforage,i=g.Redux,j=(i.bindActionCreator,"CHANGE_ROUTE"),k=function(){var a=arguments.length<=0||void 0===arguments[0]?"":arguments[0],b=arguments[1];switch(b.type){case j:return b.route;default:return a}},l="PEER_REGISTER",m="PEER_CHANGE_NAME",n="PEER_CHANGE_CONN_NAME",o="PEER_CONNECTED",p="PEER_CHANGE_MESSAGE",q="PEER_SEND_MESSAGE",r="PEER_RECIEVE_MESSAGE",s=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},t=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),u=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},v=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)},w=function(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b},x=function(){var a=arguments.length<=0||void 0===arguments[0]?"":arguments[0],b=arguments[1];switch(b.type){case l:return u({},a,{registered:!0});case m:return u({},a,{name:b.name});case n:return u({},a,{connName:b.name});case p:return u({},a,{connMessage:b.message});case q:return u({},a,{connMessage:""});default:return a}},y=function(){var a=arguments.length<=0||void 0===arguments[0]?"":arguments[0],b=arguments[1];switch(b.type){case o:var c=a.filter(function(a){var c=a.id;return c==b.id});return c.length?a:a.concat({id:b.id,unsentMessage:"",log:[]});case q:return a.map(function(a){return a.id==b.id?u({},a,{log:a.log.concat({message:b.message,type:"send"})}):a});case r:return a.map(function(a){return a.id==b.id?u({},a,{log:a.log.concat({message:b.message,type:"recieve"})}):a});default:return a}},z=window.interfaces.Redux,A=z.combineReducers({route:k,peer:x,logs:y}),B={searchForm:function(){return{type:"CHANGE_ROUTE",route:"/searchForm"}},searchResult:function(){return{type:"CHANGE_ROUTE",route:"/searchResult"}},notFound:function(){return{type:"CHANGE_ROUTE",route:"/notFound"}}},C=window.interfaces.page,D=function(a){C.start({popstate:!0}),C.base(e.base),C("/",function(){C.redirect("/searchForm")}),C("/searchForm",function(){a.searchForm()}),C("/searchResult",function(){a.searchResult()}),C("*",function(){a.notFound()})},E={onRegister:function(){return{type:l}},onChangeName:function(a){return{type:m,name:a}},onChangeConnName:function(a){return{type:n,name:a}},onConnection:function(a){return{type:o,id:a}},onChangeMessage:function(a){return{type:p,message:a}},onSendMessage:function(a,b){return{type:q,id:a,message:b}},onRecieveMessage:function(a,b){return{type:r,id:a,message:b}}},F=window.interfaces.Virtual,G=function(a){function b(){return s(this,b),w(this,a.apply(this,arguments))}return v(b,a),b.prototype.shouldComponentUpdate=function(a,b){return a.logs!=this.props.logs},b.prototype.render=function(){var a=this.props,b=a.logs,c=a.connId;if(b.length){var d=b.filter(function(a){var b=a.id;return b==c}),e=d.pop(),f=e.log.map(function(a,b){var c=a.type,d=a.message,e="message "+c;return F.createElement("span",{key:b,className:e},d)});return F.createElement("div",{className:"messageList"},f)}return null},b}(F.Component),H=window.interfaces.Virtual,I=function(a){function b(){s(this,b);var c=w(this,a.apply(this,arguments));return c.connList=[],c.register=c.register.bind(c),c.connect=c.connect.bind(c),c.send=c.send.bind(c),c}return v(b,a),b.prototype.register=function(){var a=this,b=this.props,c=b.user,d=b.actions,e=c.name;this.peer=new window.Peer(e,{key:"45x1mf8qyx7833di"}),this.peer.on("connection",function(b){b.on("data",function(b){var c=a.props.user;d.onRecieveMessage(c.connName,b)})}),d.onRegister()},b.prototype.connect=function(){var a=this.props,b=a.user,c=a.actions,d=this.connList.filter(function(a){var c=a.id;return c==b.connName});d.length?this.conn=d.pop().conn:(this.conn=this.peer.connect(b.connName),this.connList.push({id:b.connName,conn:this.conn})),c.onConnection(b.connName)},b.prototype.send=function(){var a=this.props,b=a.user,c=a.actions,d=b.connMessage;return this.conn.send(d),c.onSendMessage(b.connName,d),"...."},b.prototype.render=function(){var a=this.props,b=a.user,c=a.actions,d=a.logs,e=void 0;if(b.registered){var f=H.createElement("div",null,H.createElement(G,{logs:d,connId:b.connName}),H.createElement("textarea",{placeholder:"Message",onChange:function(a){c.onChangeMessage(a.target.value)},value:b.connMessage}),H.createElement("button",{onClick:this.send},"Send")),g=H.createElement("div",null,H.createElement("input",{placeholder:"Peer name",onChange:function(a){c.onChangeConnName(a.target.value)},value:b.connName}),H.createElement("button",{onClick:this.connect},"Connect"));e=H.createElement("div",null,H.createElement("label",null,"Welcome ",b.name),g,f)}else e=H.createElement("div",null,H.createElement("input",{placeholder:"You name",onChange:function(a){c.onChangeName(a.target.value)},value:b.name}),H.createElement("button",{onClick:this.register},"Register"));return e},b}(H.Component),J=window.interfaces,K=J.Virtual,L=J.Redux,M=J.page,N=L.bindActionCreators,O=function(b){function c(){s(this,c);var d=w(this,b.apply(this,arguments));return D(N(B,d.store.dispatch)),d.peerActions=N(E,d.store.dispatch),d.store.subscribe(function(){a(d.store.getState())}),M.redirect(document.location.pathname),d}return v(c,b),c.prototype.render=function(){return K.createElement("div",null,K.createElement(I,{logs:this.state.logs,user:this.state.peer,actions:this.peerActions}))},t(c,[{key:"initialState",get:function(){var a={route:"/",peer:{name:"",registered:!1,connName:"",connMessage:""},logs:[]};return this.props.lastState&&(this.props.lastState.peer.registered=!1,this.props.lastState.peer.connected=!1),this.props.lastState||a}},{key:"reducer",get:function(){return A}}]),c}(K.Component),P=window.interfaces,Q=P.Virtual,R=P.VirtualDom;b().then(function(a){var b=document.createElement("div");document.body.appendChild(b),R.render(Q.createElement(O,{lastState:a}),b)})}();