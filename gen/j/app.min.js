!function(){"use strict";function a(a){return"/notFound"==a.route&&"/"==a.route,h.setItem("appState",a)}function b(){h.config(e.storage);var a=void 0;return a=new f(function(a,b){h.getItem("version").then(function(b){!b||b<e.storage.version?(h.removeItem("appState").then(function(){h.setItem("version",e.storage.version)}),a(null)):h.getItem("appState").then(function(b){a(b)})})})}var c="//"+document.location.host,d={name:"naukriDB",version:9,storeName:"naukriStore",description:"Naukri jobseeker SPA"},e={base:c,storage:d},f="undefined"==typeof Promise?require("es6-promise").Promise:Promise,g=window.interfaces,h=g.localforage,i=g.Redux,j=(i.bindActionCreator,"CHANGE_ROUTE"),k=function(){var a=arguments.length<=0||void 0===arguments[0]?"/":arguments[0],b=arguments[1];switch(b.type){case j:return b.route;default:return a}},l="PEER_REGISTER",m="PEER_CHANGE_NAME",n="PEER_CHANGE_CONN_NAME",o="PEER_CONNECTED",p="PEER_CHANGE_MESSAGE",q="PEER_SEND_MESSAGE",r="PEER_RECIEVE_MESSAGE",s=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},t=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),u=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},v=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)},w=function(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b},x=function(){var a,b,c=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],d=arguments[1];switch(d.type){case o:if(!c[d.id]){var e;return u({},c,(e={},e[d.id]=u({},c[d.id],{messageField:"",detail:[d.id],logs:[]}),e))}return c;case p:return u({},c,(a={},a[d.id]=u({},c[d.id],{messageField:d.message}),a));case r:case q:return u({},c,(b={},b[d.id]=u({},c[d.id],{logs:c[d.id].logs.concat({message:d.message,method:d.method,time:d.time})}),b));default:return c}},y=function(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=arguments[1];switch(b.type){case l:case o:if(a[b.id])return a;var c;return u({},a,(c={},c[b.id]={id:b.id,name:b.name},c));default:return a}},z=function(){var a=arguments.length<=0||void 0===arguments[0]?{1:{id:1,idField:"",detail:"",contacts:[],contactSearchField:"",connContactId:""}}:arguments[0],b=arguments[1];switch(b.type){case l:return u({},a,{1:u({},a[1],{detail:b.id})});case m:return u({},a,{1:u({},a[1],{idField:b.name})});case n:return u({},a,{1:u({},a[1],{contactSearchField:b.name})});case o:var c=a[1].contacts.filter(function(a,c){return a!=b.id});return c.unshift(b.id),u({},a,{1:u({},a[1],{connContactId:b.id,contacts:c})});default:return a}},A=window.interfaces.Redux,B=A.combineReducers({route:k,account:z,user:y,contacts:x}),C="/chat/register",D="/chat/contacts",E="/chat/connect",F={register:function(){return{type:"CHANGE_ROUTE",route:C}},contacts:function(a){return{type:"CHANGE_ROUTE",route:D+"/"+a}},connect:function(a,b){return{type:"CHANGE_ROUTE",route:E+"/"+a+"/"+b}},notFound:function(){return{type:"CHANGE_ROUTE",route:"/chat/notFound"}}},G=window.interfaces.page,H=function(a){G.start({popstate:!0}),G.base(e.base),G("/",function(){G.redirect(C)}),G(C,function(){a.register()}),G(D+"/:id",function(b){a.contacts(b.params.id)}),G(E+"/:id/:connId",function(b){a.connect(b.params.id,b.params.connId)}),G("*",function(){a.notFound()})},I={onRegister:function(a){return{type:l,id:a}},onChangeName:function(a){return{type:m,name:a}},onChangeConnName:function(a){return{type:n,name:a}},onConnection:function(a){return{type:o,id:a}},onChangeMessage:function(a,b){return{type:p,id:a,message:b}},onSendMessage:function(a,b){return{type:q,method:"send",id:a,message:b}},onRecieveMessage:function(a,b){return{type:r,method:"receive",id:a,message:b}}},J=null,K=function(){function a(){return s(this,a),J||(J=this,this.peer=null,this.connName=null,this.conn=null,this.connList=[]),J}return a.prototype.register=function(a,b){var c=this;this.peer=new window.Peer(a,{key:"45x1mf8qyx7833di"}),this.peer.on("connection",function(a){a.on("data",function(a){b(c.connName,a)})})},a.prototype.connect=function(a){var b=this;this.connName=a;var c=this.connList.filter(function(a){var c=a.id;return c==b.connName});c.length?this.conn=c.pop().conn:(this.conn=this.peer.connect(this.connName),this.connList.push({id:a,conn:this.conn}))},a.prototype.send=function(a){return this.conn.send(a),"...."},a}(),L=window.interfaces,M=L.Virtual,N=L.page,O=function(a){function b(){s(this,b);var c=w(this,a.apply(this,arguments));return c.peer=new K,c.register=c.register.bind(c),c}return v(b,a),b.prototype.shouldComponentUpdate=function(a){return a.idField!=this.props.idField},b.prototype.register=function(){var a=this.props,b=a.idField,c=a.onRegister,d=a.onRecieveMessage;this.peer.register(b,d),c(b),N(D+"/"+b)},b.prototype.render=function(){var a=this.props,b=a.idField,c=a.onChangeName;return M.createElement("div",null,M.createElement("input",{type:"tel",placeholder:"Mobile number",onChange:function(a){c(a.target.value)},value:b}),M.createElement("button",{onClick:this.register},"Register"))},b}(M.Component),P=window.interfaces,Q=P.Virtual,R=P.page,S=function(a){function b(){s(this,b);var c=w(this,a.apply(this,arguments));return c.peer=new K,c}return v(b,a),b.prototype.connect=function(a,b){this.peer.connect(b),this.props.onConnection(b),R(E+"/"+a+"/"+b)},b.prototype.shouldComponentUpdate=function(a){return a.searchField!=this.props.searchField||a.contactIds!=this.props.contactIds},b.prototype.render=function(){var a=this,b=this.props,c=b.contactIds,d=b.searchField,e=b.id,f=b.contacts,g=b.onChangeConnName,h=c.filter(function(a){return-1!=a.indexOf(d)}).map(function(b){var c=f[b];return Q.createElement("li",{key:b},Q.createElement("a",{href:"javascript:void(0)",onClick:function(){a.connect(e,b)}},c.name))});return Q.createElement("div",null,Q.createElement("input",{placeholder:"Search",onChange:function(a){g(a.target.value)},value:d}),Q.createElement("button",{onClick:function(){return a.connect(e,d)}},"Add"),Q.createElement("ul",null,h))},b}(Q.Component),T=window.interfaces.Virtual,U=function(a){function b(){return s(this,b),w(this,a.apply(this,arguments))}return v(b,a),b.prototype.shouldComponentUpdate=function(a,b){return a.logs!=this.props.logs},b.prototype.render=function(){var a=this.props,b=a.logs,c=(a.connId,b.map(function(a,b){var c=a.method,d=a.message,e="message "+c;return T.createElement("span",{key:b,className:e},d)}));return T.createElement("div",{className:"messageList"},c)},b}(T.Component),V=window.interfaces.Virtual,W=function(a){function b(){s(this,b);var c=w(this,a.apply(this,arguments));return c.peer=new K,c.send=c.send.bind(c),c}return v(b,a),b.prototype.send=function(){var a=this.props,b=a.contactId,c=a.messageField,d=a.onSendMessage;this.peer.send(c),d(b,c)},b.prototype.render=function(){var a=this.props,b=a.contactId,c=a.logs,d=a.messageField,e=a.onChangeMessage;return V.createElement("div",null,V.createElement(U,{logs:c,connId:b}),V.createElement("textarea",{placeholder:"Message",onChange:function(a){e(b,a.target.value)},value:d}),V.createElement("button",{onClick:this.send},"Send"))},b}(V.Component),X=window.interfaces,Y=X.Virtual,Z=X.Redux,$=X.page,_=Z.bindActionCreators,aa=function(b){function c(){s(this,c);var d=w(this,b.apply(this,arguments));return H(_(F,d.store.dispatch)),d.peerActions=_(I,d.store.dispatch),d.store.subscribe(function(){a(d.store.getState())}),$.redirect(document.location.pathname),d}return v(c,b),c.prototype.render=function(){var a=null;if(Object.keys(this.state).length){var b=this.state,c=b.route,d=b.account,e=b.contacts,f=(b.user,b.actions);if(d=d[1],-1!=c.indexOf(C)&&(a=Y.createElement(O,{idField:d.idField,onChangeName:f.onChangeName,onRegister:f.onRegister,onRecieveMessage:f.onRecieveMessage})),-1!=c.indexOf(D)&&(a=Y.createElement(S,{contactIds:d.contacts,searchField:d.contactSearchField,id:d.detail,contacts:e,onChangeConnName:f.onChangeConnName,onConnection:f.onConnection})),-1!=c.indexOf(E)){var g=e[d.connContactId];a=Y.createElement(W,{contactId:d.connContactId,logs:g.logs,messageField:g.messageField,onChangeMessage:f.onChangeMessage,onSendMessage:f.onSendMessage})}}return a},t(c,[{key:"initialState",get:function(){return this.props.lastState||{}}},{key:"reducer",get:function(){return B}}]),c}(Y.Component),ba=window.interfaces,ca=ba.Virtual,da=ba.VirtualDom;b().then(function(a){da.render(ca.createElement(aa,{lastState:a}),document.getElementById("root"))})}();